<html>
<head>
  <meta charset="utf-8" />
  <title>Buttons</title>
  <link rel="stylesheet" href="buttons.css" />
  <script src="ble-client.js"></script>
  <script src="https://kit.fontawesome.com/a076d05399.js"></script>
</head>
<body>
  <ul>
    <li id="up" class="hidden"><a href="#">ᐃ</a></li>
    <li id="down" class="hidden"><a href="#">ᐁ</a></li>
    <li id="connect"><i class="cyan fab fa-bluetooth-b"></i></li>
  </ul>
</body>
</html>
<script>
  /* helper function to decode message sent from peripheral */
  function decode(buf) {
    let dec = new TextDecoder("utf-8");
    return dec.decode(buf);
  }

  /* Disconnect from peripheral and update UI */
  function disconnect() {
    gateBLE.disconnect();
    document.getElementById("up").classList.add("hidden");
    document.getElementById("down").classList.add("hidden");
  }

  const gateBLE = new GateBLE();
  const up = document.getElementById("up");
  const down = document.getElementById("down");
  
  /* connect to peripheral, load data and add event listeners */
  document
    .getElementById("connect")
    .addEventListener("click", async event => {
      try {
        await gateBLE.request();
        await gateBLE.connect();
        await gateBLE.setUpCharacteristic();
        document.getElementById("connect").classList.add("hidden");

        up.addEventListener("click", e => {
          //if (e.target.checked) {
            gateBLE.writeDown(0);
            gateBLE.writeUp(1);
            /* valido per il toggle
            up.disabled = true;
            setTimeout(() => {
              up.disabled = false;
            }, 1000);
          } else {
            gateBLE.writeUp(0);
            /* valido per il toggle
            up.disabled = true;
            setTimeout(() => {
              up.disabled = false;
            }, 1000);
          }*/
        });

        down.addEventListener("click", e => {
          //if (e.target.checked) {
            gateBLE.writeUp(0);
            gateBLE.writeDown(1);
            /* valido per il toggle
            down.disabled = true;
            setTimeout(() => {
              down.disabled = false;
            }, 1000);
            } else {
            gateBLE.writeDown(0);
            /* valido per il toggle
            down.disabled = true;
            setTimeout(() => {
              down.disabled = false;
            }, 1000);
          }*/
        });

        document.getElementById("up").classList.remove("hidden");
        document.getElementById("down").classList.remove("hidden");
      } catch (error) {
        console.log(error.message);
      }
    });
</script>
